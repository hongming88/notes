

# 逻辑架构

<img src="..\..\pics\database\Mysql\逻辑架构2.png" style="zoom:45%;" />

<img src="..\..\pics\database\Mysql\逻辑架构.png" style="zoom:75%;" />



## 连接层

<font color="red">**每一个客户端发起一个新的请求都由服务器端的连接/线程处理工具负责接收客户端的请求并开辟一个新的内存空间，在服务器端的内存中生成一个新的线程，当每一个用户连接到服务器端的时候就会在进程地址空间里生成一个新的线程用于响应客户端请求，用户发起的查询请求都在线程空间内运行， 结果也在这里面缓存并返回给服务器端**</font>。线程的重用和销毁都是由连接/线程处理管理器实现的。

　　综上所述：用户发起请求，连接/线程处理器开辟内存空间，开始提供查询的机制。


最上层是一些客户端和连接服务，包含本地sock 通信和大多数基于客户端/服务端工具实现的类似于tcp/ip 的通信。主要完成一些类似于连接处理、授权认证、及相关的安全方案。在**该层上引入了线程池的概念，为通过认证安全接入的客户端提供线程**。同样在该层上可以实现基于SSL 的安全链接。服务器也会为安全接入的每个客户端验证它所具有的操作权限。



可以通过如下命令查看连接配置信息：`SHOW VARIABLES LIKE '%connect%';`可以看到最大连接和每个连接占用的内存等相关配置。



## 服务层

| Management Serveices & Utilities | 系统管理和控制工具                                           |
| -------------------------------- | ------------------------------------------------------------ |
| SQL Interface:                   | 接口。接受用户的SQL 命令，并且返回用户需要查询的结果。比如select from就是调用SQL Interface |
| Parser                           | 解析器。SQL 命令传递到解析器的时候会被解析器验证和解析       |
| Optimizer                        | 查询优化器。SQL 语句在查询之前会使用查询优化器对查询进行优化，比如有where 条件时，优化器来决定先投影还是先过滤。 |
| Cache 和Buffer                   | 查询缓存。如果查询缓存有命中的查询结果，查询语句就可以直接去查询缓存中取数据。这个缓存机制是由一系列小缓存组成的。比如表缓存，记录缓存，key 缓存，权限缓存等 |

## 引擎层
存储引擎层，存储引擎真正的负责了MySQL 中数据的存储和提取，服务器通过API 与存储引擎进行通信。不同
的存储引擎具有的功能不同，这样我们可以根据自己的实际需要进行选取。

可以通过下面两个命令查看MySQL当前版本，和对存储引擎的支持情况。

```sql
SELECT VERSION() ; SHOW ENGINES ;
```



## 存储层
数据存储层，主要是将数据存储在运行于裸设备的文件系统之上，并完成与存储引擎的交互。



## **MySQL查询过程**

<img src="..\..\pics\database\Mysql\查询过程.png" style="zoom:44%;" />



参考连接：https://blog.csdn.net/fuzhongmin05/article/details/70904190



## MyISAM 和InnoDB



| 对比项         |                          MyISAM                          |                            InnoDB                            |
| -------------- | :------------------------------------------------------: | :----------------------------------------------------------: |
| 外键           |                          不支持                          |                             支持                             |
| 事务           |                          不支持                          |                             支持                             |
| 行表锁         | 表锁，即使操作一条记录也会锁住整个表，不适合高并发的操作 | 行锁,操作时只锁某一行，不对其它行有影响，**适合高并发**的操作 |
| 缓存           |                只缓存索引，不缓存真实数据                | 不仅缓存索引还要缓存真实数据，对内存要求较高，而且内存大小对性能有决定性的影响 |
| 关注点         |                          读性能                          |                      并发写、事务、资源                      |
| 默认安装       |                            Y                             |                              Y                               |
| 默认使用       |                            N                             |                              Y                               |
| 自带系统表使用 |                            Y                             |                              N                               |









# 索引是什么

**MySQL官方对索引的定义为：索引（Index）是帮助MySQL高效获取数据的数据结构。可以得到索引的本质：索引是数据结构。**










